## 简介

红黑树是一种自平衡二叉查找树（不是平衡二叉树，只不过红黑树近似于平衡的状态）,它相对于二叉查找树性能会更加高效(查找、删除、添加等操作需要O(log n),其中n为树中元素的个数),但实现较为复杂(需要保持自身的平衡)。

红黑树的规则：

1. 每个节点要么是红色，要么是黑色
2. 根节点是黑色
3. 如果一个节点是红色，那么它的两个孩子都是黑色（从每个叶子到根的所有路径上不能有两个连续的红色节点）
4. 从根到叶节点或空子节点的每条路径，必须包含相同的黑色节点



![image-20220408225216360](./img/image-20220408225216360.png)

从根到叶节点的路径上的黑色节点的数目称为`黑色高度`

## 插入操作

红黑树的插入操作与[二叉搜索树](https://www.jianshu.com/p/59701ade8082)的一致，将新插入的节点初始化，颜色设置为`红色`后插入到指定位置，插入前有几种情形，

接下来，将分析插入红色节点后红黑树的情况。假设要**插入的节点为 N**，**N 的父节点为 P**，**祖父节点为 G**，**叔叔节点为 U**。插入红色节点后(要被插入的节点都会被设置为红色)，会出现5种情况，分别如下：

### 情形1

简单情形，插入的新节点 N 是红黑树的根节点，这种情况下，我们把节点 N 的颜色由红色变为黑色。

![image-20220408231123453](./img/image-20220408231123453.png)



### 情形2

简单情形，N 的父节点是黑色，并不会影响红黑树的平衡，直接插入即可，无需做自平衡。

![image-20220408231200621](./img/image-20220408231200621.png)





### 情形3

N 的父节点是红色（节点 P 为红色，其父节点必然为黑色），叔叔节点 U 也是红色。由于 P 和 N 均为红色，此时需要进行调整。这种情况下，先将 P 和 U 的颜色染成黑色，再将 G 的颜色染成红色。但需要注意的是 G 被染成红色后，可能会和它的父节点形成连续的红色节点，**此时需要递归向上调整**

![image-20220408231753396](./img/image-20220408231753396.png)



### 情形4

N 的父节点为红色，叔叔节点为黑色。N 是 P 的左孩子，且节点 P 是 G 的左孩子。此时对 G 进行右旋，调整 P 和 G 的位置，并互换颜色。绿色的节点代表任何节点

![image-20220408232417598](./img/image-20220408232417598.png)



### 情形5：

N 的父节点为红色，叔叔节点为黑色。节点 N 是 P 的右孩子，且节点 P 是 G 的左孩子。此时先对节点 P 进行左旋，调整 N 与 P 的位置。然后G右旋。把N变为黑色。

![image-20220408233128052](./img/image-20220408233128052.png)





## 删除操作

红黑树的删除操作分成2个部分：
1.按照[二叉搜索树](https://www.jianshu.com/p/59701ade8082)的删除逻辑一样删除节点。
2.重新调整删除节点后的树，使之重新成为红黑树。

在二叉查找树删除节点时，分为 3 种情况：

- 若该删除节点本身是叶子节点，则可以直接删除；
- 若只有一个孩子节点（左孩子或者右孩子），则直接让其孩子节点顶替该删除节点；
- 若有两个孩子结点，则找到该节点的后继节点，用后继节点的值替换删除节点，然后删除后继节点。

以上三种情况最终都需要删除某个节点，此时需要判断删除该节点是否会破坏红黑树的性质。判断的依据是：
1.如果删除结点的颜色为红色，则不会破坏。
2.如果删除结点的颜色为黑色，则肯定会破坏红黑树的第 4 条性质，此时就需要对树进行调整。



































模拟数据结构的网站推荐 https://www.cs.usfca.edu/~galles/visualization/Algorithms.html