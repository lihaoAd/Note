## 疑问

- 数字征书是什么
- PKI和CA是什么
- 数字征书与公钥密码算法有什么关系
- 既然有了数字征书，为什么还需要私钥
- 既然数字征书是公开的，还需要U盾干什么



专门负责颁发数字证书的系统成为CA系统，负责管理并运营CA系统的机构称作CA中心，所有与数字征书相关的各种概念和技术，统称PKI（public Key Infrastructure）。

## 密码学

### 对称算法

该类算法可分为流密码算法（RC4）和分组密码算法（DES、IDEA、RC2、AES、SM4）。

DES算法是以64位为分组对数据进行加解密，密钥长度为56位。

3DES又称Triple DES，是DES算法的变种，使用3个56位密钥对数据进行3次加密，则3DES算法的密钥长度为168位。

SM4算法的信息块长度为128位，密钥长度为128位。





### 非对称算法

RSA、DH、DSA、ECDSA、ECC、SM2

### 摘要算法

MD5、SHA1、SM3

## 密钥管理

 - 密钥产生
- 密钥传输
- 密钥验证
- 密钥更新
- 密钥存储
- 密钥备份
- 密钥销毁
- 密钥有效期
- 密钥使用

### 对称密钥管理

#### 无中心模式

每对用户通过协商获得一个共享密钥，协商得次数随用户数目呈指数增长，N个用户时，共需要协商N(N-1)/2；

![image-20210714215047966](\img\image-20210714215047966.png)



#### 有中心模式

存在一个独立得密钥管理中心，每个用户均信任该中心，密钥分配次数与用户数目呈线性关系

![image-20210714215428339](\img\image-20210714215428339.png)

由于密钥是随机产生得，无法判断属于哪个用户，因此密钥管理中心需保存密钥与用户的映射关系，存在密钥被泄露和映射关系被篡改的安全风险。

用户之间进行保密通信时，需要通过密钥管理中心动态验证对方密钥的合法性，既无法实现脱机保密通信，又容易导致密钥管理中心成为性能瓶颈。



### 非对称密钥管理

#### 无中心模式

![image-20210714220220416](\img\image-20210714220220416.png)

#### 有中心模式

也存在公钥与用户的映射关系，存在密钥被泄露和映射关系被篡改的安全风险。

![image-20210714220306250](\img\image-20210714220306250.png)

非对称密钥管理模式，尽管很好的解决了密钥协商或分配时密钥容易泄露的难题，但并没有解决好密钥与用户映射关系容易被篡改的问题，依然通过密钥管理中心集中存储公钥与用户的映射关系。

如何解决这个问题？

引入CA、数字征书、LDAP、CRL、OCSP等技术来解决



## CA与数字证书

为解决公钥与用户映射关系容易被篡改的问题，PKI引入CA与数字证书技术

CA是CA中心或证书认证中心，拥有自己的公钥和私钥，负责给用户签发数字证书，即使用CA中心私钥对用户身份信息和公钥信息进行加密处理（签名）后形成数字证书。

数字征书是一种特殊的文件格式，包含用户的身份信息、用户的公钥信息和CA中心私钥签名。

**获取数字证书后，使用CA中心的公钥对数字证书中私钥的签名进行解密处理后，就可验证该数字证书是否被篡改**

CA中心存储着所有用户的数字证书，为方便用户快速获得交易对方的数字证书，避免CA中心成为性能瓶颈，PKI又引入LDAP技术，对外提供证书查询或下载。

当用户私钥泄露后，CA中心有责任将该用户的证书标记为失效，但是用户如何获得对方证书是否失效的状态呢？为此，PKI引入CRL和OCSP技术。

CRL是证书作废列表，包含所有失效的证书清单、下次CRL生成时间和CA中心私钥的签名。

PKI引入MKC，用于对私钥的全生命周期进行管理，用户公钥对可由KMC产生，提交CA签发数字证书后，将私钥和数字证书同时安全以交给用户，而KMC将私钥留作备份。



签发过程：

1. 将用户身份信息和用户公钥信息，按照特定格式组成数据D
2. 选择摘要算法对数据D进行计算得到摘要H
3. 使用CA私钥对摘要H进行加密得到数字签名S
4. 将用户信息、用户公钥信息和数字签名S，按照特定格式就可组成数字证书





