## 计算不带括号的四则运算



```java
	private final Stack<Character> symbolStack = new Stack<>();
    private final Stack<Double> numStack = new Stack<>();

    /**
    *  -5+5+2*2-1+10/5+10/5/2*2*2
     * 计算不带括号的四则运算
     */
    private double caculateSimple(String str) {
        // 解析遇到的字符
        char temp;
        // 解析遇到的数字
        StringBuilder tempNum = new StringBuilder();
        for (int i = 0; i < str.length(); i++) {
            temp = str.charAt(i);
            if (' ' == temp) {
                // 跳过空格
                continue;
            }

            if (Character.isDigit(temp)) {
                // 遇到数字，追加
                tempNum.append(temp);
                continue;
            }

            // 接下来既不是空格也不是数字，就把之前积累的数字压栈
            if(parseNum(tempNum.toString())){
                // 清空，给下次使用
                tempNum.delete(0, tempNum.length());
            }

            if (!symbolStack.empty()) {
                char last = symbolStack.lastElement();
                if (last == '*' || last == '/') {
                    // 第二个操作数
                    double a = numStack.pop();
                    // 第一个操作数
                    double b = numStack.pop();
                    if (last == '*') {
                        numStack.push(b * a);
                    } else {
                        numStack.push(b / a);
                    }
                    // 既然已经经过乘或者除，就把栈顶的操作符弹出
                    symbolStack.pop();
                }
            }
            symbolStack.push(temp);

        }

        // 处理最后解析的数字
        if(parseNum(tempNum.toString())){
            // 清空，给下次使用
            tempNum.delete(0, tempNum.length());
        }

        while (!symbolStack.isEmpty()) {
            double a = numStack.pop();
            double b = numStack.pop();
            char last = symbolStack.pop();
            if (last == '+') {
                numStack.push(b + a);
            } else if (last == '-') {
                numStack.push(b - a);
            } else if (last == '*') {
                numStack.push(b * a);
            } else if (last == '/') {
                numStack.push(b / a);
            }
        }
        return numStack.pop();
    }

    private boolean parseNum(String numStr) {
        if (numStr.length() != 0) {
            double num = Double.parseDouble(numStr);
            if (!symbolStack.isEmpty()) {
                char last = symbolStack.lastElement();
                if (last == '-') {
                    // 转为负数
                    num = -1 * num;
                    // 把栈顶的符号弹出
                    symbolStack.pop();
                    if (numStack.size() > 0) {
                        symbolStack.push('+');
                    }
                }
            }
            // 将前面个的数字压栈
            numStack.push(num);
            return true;
        }
        return false;
    }
```

